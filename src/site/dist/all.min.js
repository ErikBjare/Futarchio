app=angular.module("FutarchioApp",["ngResource","ngRoute","ngCookies"]),app.config(["$routeProvider","$locationProvider",function(l){l.when("/",{templateUrl:"home.html",controller:"HomeController"}).when("/polls",{templateUrl:"polls.html",controller:"PollsController"}).when("/predictions",{templateUrl:"predictions.html",controller:"PredictionsController"}).when("/profile/:username",{templateUrl:"profile.html",controller:"ProfileController"}).when("/profile",{templateUrl:"profile.html",controller:"ProfileController"}).when("/admin",{templateUrl:"admin.html",controller:"AdminController"}).when("/logout",{templateUrl:"logout.html",controller:"LogoutController"}).when("/login",{templateUrl:"login.html",controller:"LoginController"})}]);
app.controller("MainController",["$scope","$route","$location","user",function(o,e,r,n){o.links_left=[{title:"Polls",url:"polls",beta:!0},{title:"Predictions",url:"predictions",alpha:!0}],o.location=r,o.user=n}]),app.controller("HomeController",["$scope","$log",function(){}]),app.controller("AdminController",["$scope","$resource","msgStack","User",function(o,e,r,n){o.resources=["users","idklol"],o.keys=["email","id"],o.stdin="",o.log=function(e){o.stdout=r(o,e),o.stdin=""},o.findUser=function(){var e=n(o.lookupKey,o.lookupValie);console.log(e)}}]),app.controller("PollsController",["$scope","$resource","$log",function(o){o.polls=[{creator:"erb",text:"This is a poll"},{creator:"clara",text:"This is another poll"}],o.time=(new Date).toISOString()}]),app.controller("PredictionsController",["$scope","$resource","$log",function(){}]),app.controller("PollController",["$scope","$resource","$log",function(o){o.voted=!0,o.votes=0,o.rating=0,o.vote=function(e){o.votes+=1,o.rating=e?o.rating+1:o.rating-1,o.trues=Math.round(1e3*(1+o.rating/o.votes)/2)/10,o.falses=Math.round(1e3*(1-o.rating/o.votes)/2)/10,console.log(o.rating),o.voted=!0}}]),app.controller("ProfileController",["$scope","$routeParams","$location","$cookieStore","gravatar","User",function(o,e,r,n,l,t){return console.log("Missing username routeParam"),e.username?(o.user={},void t("username",e.username).$promise.then(function(e){console.log(e),o.profile=e.data[0],o.profile.gravatar_hash=l.hash(o.profile.email)},function(){o.loading_error=!0})):(console.log("Missing username routeParam"),me=n.get("me"),console.log(me),void(void 0!==me?(console.log("Redirecting to profile"),r.path("/profile/"+me.username)):(console.log("Redirecting to login"),r.path("/login"))))}]),app.controller("LoginController",["$scope","$routeParams","$location","user","$http",function(o,e,r,n){o.logging_in=!1,n.is_logged_in()?r.path("/profile/"+n.username()):o.logged_in=!1,o.login=function(){o.logging_in=!0,n.login(o.username,o.password).then(function(){o.error="",r.path("/profile/"+o.username),o.logging_in=!1},function(e){o.error=e,o.logging_in=!1})}}]),app.controller("LogoutController",["user",function(o){o.logout()}]);
app.factory("msgStack",function(){var r=[];return function(e){return""===msg?r:(r.push({type:"info",msg:msg}),void console.log(e))}}),app.factory("User",["$log","$resource",function(r,e){var t=e("/api/0/:resource/:key/:val",{});return function(e,o){var n=t.get({resource:"users",key:e,val:o},function(e){r.info(e.data[0])},function(){r.error("Error")});return n}}]),app.factory("gravatar",["$log","$resource",function(){var r={};return r.hash=function(r){_.contains(r,"@")||console.error("Error: got empty email");var e=CryptoJS.MD5(r).toString();return e},r}]),app.factory("user",["$q","$log","$http","$route","$cookieStore","$location","gravatar",function(r,e,t,o,n,a,u){var i={};return i.is_logged_in=function(){return val=n.get("me")&&n.get("auth")},i.login=function(e,o){var a=r.defer();return t.post("/api/0/auth",{username:e,password:o}).success(function(r){console.log(r),r.auth?(n.put("auth",r.auth),t.get("/api/0/users/me",{headers:{Authorization:r.auth}}).success(function(r){console.log(r),n.put("me",{username:e,email:r.data[0].email}),a.resolve(r)})):a.reject(r.error)}).error(function(){error="Something went wrong while trying to make request",a.reject(error)}),a.promise},i.logout=function(){n.remove("auth"),n.remove("me"),a.path("/"),o.reload()},i.username=function(){return n.get("me").username},i.email=function(){return n.get("me").email},i.gravatar_hash=function(){return u.hash(i.email())},i}]);
app.filter("capitalize",function(){return function(t){return output=t[0].toUpperCase()+t.substr(1,t.length)}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXJzLmpzIiwiZmFjdG9yaWVzLmpzIiwiZmlsdGVycy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLFFBQUEsT0FBQSxnQkFBQSxhQUFBLFVBQUEsY0FFQSxJQUFBLFFBQVcsaUJBQUEsb0JBQUEsU0FBQSxHQUNULEVBQ0MsS0FBQSxLQUNDLFlBQUEsWUFDQSxXQUFBLG1CQUVELEtBQUEsVUFDQyxZQUFBLGFBQ0EsV0FBQSxvQkFFRCxLQUFBLGdCQUNDLFlBQUEsbUJBQ0EsV0FBQSwwQkFFRCxLQUFBLHNCQUNDLFlBQUEsZUFDQSxXQUFBLHNCQUVELEtBQUEsWUFDQyxZQUFBLGVBQ0EsV0FBQSxzQkFFRCxLQUFBLFVBQ0MsWUFBQSxhQUNBLFdBQUEsb0JBRUQsS0FBQSxXQUNDLFlBQUEsY0FDQSxXQUFBLHFCQUVELEtBQUEsVUFDQyxZQUFBLGFBQ0EsV0FBQTtBQ2xDSixJQUFBLFdBQUEsa0JBQWlDLFNBQUEsU0FBQSxZQUFBLE9BQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUM3QixFQUFBLGFBQUEsTUFBQSxRQUFBLElBQUEsUUFBQSxNQUFBLElBQ2dCLE1BQUEsY0FBQSxJQUFBLGNBQUEsT0FBQSxJQUNoQixFQUFBLFNBQUEsRUFDQSxFQUFBLEtBQUEsS0FHSixJQUFBLFdBQUEsa0JBQWlDLFNBQUEsT0FBQSxlQUdqQyxJQUFBLFdBQUEsbUJBQWtDLFNBQUEsWUFBQSxXQUFBLE9BQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUM5QixFQUFBLFdBQUEsUUFBQSxVQUNBLEVBQUEsTUFBQSxRQUFBLE1BQ0EsRUFBQSxNQUFBLEdBRUEsRUFBQSxJQUFBLFNBQUEsR0FDSSxFQUFBLE9BQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxNQUFBLElBR0osRUFBQSxTQUFBLFdBQ0ksR0FBQSxHQUFBLEVBQUEsRUFBQSxVQUFBLEVBQUEsWUFDQSxTQUFBLElBQUEsT0FJUixJQUFBLFdBQUEsbUJBQWtDLFNBQUEsWUFBQSxP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QUFBLEVBQUEsSUFBQSxTQUlKLEVBQUEsTUFBQSxTQUFBLEVBQUEsR0FDSSxHQUFBLEdBQUEsRUFBQSxPQXFCQSxPQW5CQSxHQUFBLEtBQUEsZUFBQSxTQUFBLEVBQUEsU0FBQSxJQUNBLFFBQUEsU0FBQSxHQUNJLFFBQUEsSUFBQSxHQUNBLEVBQUEsTUFHSSxFQUFBLElBQUEsT0FBQSxFQUFBLE1BQ0EsRUFBQSxJQUFBLG1CQUFBLFNBQUEsY0FBQSxFQUFBLFFBQ0EsUUFBQSxTQUFBLEdBQ0ksUUFBQSxJQUFBLEdBQ0EsRUFBQSxJQUFBLE1BQUEsU0FBQSxFQUFBLE1BQUEsRUFBQSxLQUFBLEdBQUEsUUFDQSxFQUFBLFFBQUEsTUFQSixFQUFBLE9BQUEsRUFBQSxTQVVSLE1BQUEsV0FDSSxNQUFBLG9EQUNBLEVBQUEsT0FBQSxTQUdKLEVBQUEsU0FHSixFQUFBLE9BQUEsV0FDSSxFQUFBLE9BQUEsUUFDQSxFQUFBLE9BQUEsTUFDQSxFQUFBLEtBQUEsS0FHQSxFQUFBLFVBR0osRUFBQSxTQUFBLFdBQ0ksTUFBQSxHQUFBLElBQUEsTUFBQSxVQUdKLEVBQUEsTUFBQSxXQUNJLE1BQUEsR0FBQSxJQUFBLE1BQUEsT0FHSixFQUFBLGNBQUEsV0FDSSxNQUFBLEdBQUEsS0FBQSxFQUFBLFVBR0o7QUMzRkosSUFBQSxPQUFBLGFBQXNCLFdBQ2xCLE1BQUEsVUFBQSxHQUVJLE1BREEsUUFBQSxFQUFBLEdBQUEsY0FBQSxFQUFBLE9BQUEsRUFBQSxFQUFBIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJhcHAgPSBhbmd1bGFyLm1vZHVsZSgnRnV0YXJjaGlvQXBwJywgW1wibmdSZXNvdXJjZVwiLCBcIm5nUm91dGVcIiwgXCJuZ0Nvb2tpZXNcIl0pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuICAkcm91dGVQcm92aWRlclxuICAgLndoZW4oJy8nLCB7XG4gICAgdGVtcGxhdGVVcmw6ICdob21lLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicsXG4gIH0pXG4gICAud2hlbignL3BvbGxzJywge1xuICAgIHRlbXBsYXRlVXJsOiAncG9sbHMuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ1BvbGxzQ29udHJvbGxlcicsXG4gIH0pXG4gICAud2hlbignL3ByZWRpY3Rpb25zJywge1xuICAgIHRlbXBsYXRlVXJsOiAncHJlZGljdGlvbnMuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ1ByZWRpY3Rpb25zQ29udHJvbGxlcicsXG4gIH0pXG4gICAud2hlbignL3Byb2ZpbGUvOnVzZXJuYW1lJywge1xuICAgIHRlbXBsYXRlVXJsOiAncHJvZmlsZS5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnUHJvZmlsZUNvbnRyb2xsZXInLFxuICB9KVxuICAgLndoZW4oJy9wcm9maWxlJywge1xuICAgIHRlbXBsYXRlVXJsOiAncHJvZmlsZS5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnUHJvZmlsZUNvbnRyb2xsZXInLFxuICB9KVxuICAgLndoZW4oJy9hZG1pbicsIHtcbiAgICB0ZW1wbGF0ZVVybDogJ2FkbWluLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdBZG1pbkNvbnRyb2xsZXInLFxuICB9KVxuICAgLndoZW4oJy9sb2dvdXQnLCB7XG4gICAgdGVtcGxhdGVVcmw6ICdsb2dvdXQuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ0xvZ291dENvbnRyb2xsZXInLFxuICB9KVxuICAgLndoZW4oJy9sb2dpbicsIHtcbiAgICB0ZW1wbGF0ZVVybDogJ2xvZ2luLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXInLFxuICB9KTtcbn0pO1xuIiwiYXBwLmNvbnRyb2xsZXIoJ01haW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGUsICRsb2NhdGlvbiwgdXNlcikge1xuICAgICRzY29wZS5saW5rc19sZWZ0ID0gW3t0aXRsZTogXCJQb2xsc1wiLCB1cmw6IFwicG9sbHNcIiwgYmV0YTogdHJ1ZX0sXG4gICAgICAgICAgICAgICAgICAgIHt0aXRsZTogXCJQcmVkaWN0aW9uc1wiLCB1cmw6IFwicHJlZGljdGlvbnNcIiwgYWxwaGE6IHRydWV9XTtcbiAgICAkc2NvcGUubG9jYXRpb24gPSAkbG9jYXRpb247XG4gICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xufSk7XG5cbmFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvZykge1xufSk7XG5cbmFwcC5jb250cm9sbGVyKCdBZG1pbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyZXNvdXJjZSwgbXNnU3RhY2ssIFVzZXIpIHtcbiAgICAkc2NvcGUucmVzb3VyY2VzID0gW1widXNlcnNcIiwgXCJpZGtsb2xcIl07XG4gICAgJHNjb3BlLmtleXMgPSBbXCJlbWFpbFwiLCBcImlkXCJdO1xuICAgICRzY29wZS5zdGRpbiA9IFwiXCI7XG5cbiAgICAkc2NvcGUubG9nID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgICRzY29wZS5zdGRvdXQgPSBtc2dTdGFjaygkc2NvcGUsIG9iaik7XG4gICAgICAgICRzY29wZS5zdGRpbiA9IFwiXCI7XG4gICAgfTtcblxuICAgICRzY29wZS5maW5kVXNlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdXNlciA9IFVzZXIoJHNjb3BlLmxvb2t1cEtleSwgJHNjb3BlLmxvb2t1cFZhbGllKTtcbiAgICAgICAgY29uc29sZS5sb2codXNlcik7XG4gICAgfTtcbn0pO1xuXG5hcHAuY29udHJvbGxlcignUG9sbHNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcmVzb3VyY2UsICRsb2cpIHtcbiAgICAkc2NvcGUucG9sbHMgPSBbe1wiY3JlYXRvclwiOiBcImVyYlwiLCBcInRleHRcIjogXCJUaGlzIGlzIGEgcG9sbFwifSxcbiAgICAgICAgICAgICAgICAgICAge1wiY3JlYXRvclwiOiBcImNsYXJhXCIsIFwidGV4dFwiOiBcIlRoaXMgaXMgYW5vdGhlciBwb2xsXCJ9XTtcbiAgICAkc2NvcGUudGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbn0pO1xuXG5hcHAuY29udHJvbGxlcignUHJlZGljdGlvbnNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcmVzb3VyY2UsICRsb2cpIHtcbn0pO1xuXG5hcHAuY29udHJvbGxlcignUG9sbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyZXNvdXJjZSwgJGxvZykge1xuICAgICRzY29wZS52b3RlZCA9IHRydWU7XG4gICAgJHNjb3BlLnZvdGVzID0gMDtcbiAgICAkc2NvcGUucmF0aW5nID0gMDtcblxuICAgICRzY29wZS52b3RlID0gZnVuY3Rpb24ob3B0aW9uKSB7XG4gICAgICAgICRzY29wZS52b3RlcyArPSAxO1xuICAgICAgICAkc2NvcGUucmF0aW5nID0gb3B0aW9uID8gJHNjb3BlLnJhdGluZysxIDogJHNjb3BlLnJhdGluZy0xO1xuICAgICAgICAkc2NvcGUudHJ1ZXMgPSBNYXRoLnJvdW5kKDEwMDAqKDErKCRzY29wZS5yYXRpbmcvJHNjb3BlLnZvdGVzKSkvMikvMTA7XG4gICAgICAgICRzY29wZS5mYWxzZXMgPSBNYXRoLnJvdW5kKDEwMDAqKDEtKCRzY29wZS5yYXRpbmcvJHNjb3BlLnZvdGVzKSkvMikvMTA7XG4gICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5yYXRpbmcpO1xuICAgICAgICAkc2NvcGUudm90ZWQgPSB0cnVlO1xuICAgIH07XG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ1Byb2ZpbGVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJGNvb2tpZVN0b3JlLCBncmF2YXRhciwgVXNlcikge1xuICAgIGNvbnNvbGUubG9nKFwiTWlzc2luZyB1c2VybmFtZSByb3V0ZVBhcmFtXCIpO1xuICAgIGlmKCEkcm91dGVQYXJhbXMudXNlcm5hbWUpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJNaXNzaW5nIHVzZXJuYW1lIHJvdXRlUGFyYW1cIik7XG4gICAgICAgIG1lID0gJGNvb2tpZVN0b3JlLmdldChcIm1lXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhtZSk7XG4gICAgICAgIGlmKG1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVkaXJlY3RpbmcgdG8gcHJvZmlsZVwiKTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL3Byb2ZpbGUvXCIrbWUudXNlcm5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJSZWRpcmVjdGluZyB0byBsb2dpblwiKTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL2xvZ2luXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgIFVzZXIoXCJ1c2VybmFtZVwiLCAkcm91dGVQYXJhbXMudXNlcm5hbWUpLiRwcm9taXNlLnRoZW4oZnVuY3Rpb24ocGF5bG9hZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhwYXlsb2FkKTtcbiAgICAgICAgJHNjb3BlLnByb2ZpbGUgPSBwYXlsb2FkLmRhdGFbMF07XG4gICAgICAgICRzY29wZS5wcm9maWxlLmdyYXZhdGFyX2hhc2ggPSBncmF2YXRhci5oYXNoKCRzY29wZS5wcm9maWxlLmVtYWlsKTtcbiAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAkc2NvcGUubG9hZGluZ19lcnJvciA9IHRydWU7XG4gICAgfSk7XG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ0xvZ2luQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sIHVzZXIsICRodHRwKSB7XG4gICAgLy9UT0RPOiBTZXQgMzAgZGF5IGNvb2tpZSBleHBpcnkgdXBvbiBcIlJlbWVtYmVyIG1lXCJcbiAgICAkc2NvcGUubG9nZ2luZ19pbiA9IGZhbHNlO1xuXG4gICAgaWYodXNlci5pc19sb2dnZWRfaW4oKSkge1xuICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9wcm9maWxlL1wiK3VzZXIudXNlcm5hbWUoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLmxvZ2dlZF9pbiA9IGZhbHNlO1xuICAgIH1cblxuICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUubG9nZ2luZ19pbiA9IHRydWU7XG4gICAgICAgIHVzZXIubG9naW4oJHNjb3BlLnVzZXJuYW1lLCAkc2NvcGUucGFzc3dvcmQpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gXCJcIjtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL3Byb2ZpbGUvXCIrJHNjb3BlLnVzZXJuYW1lKTtcbiAgICAgICAgICAgICRzY29wZS5sb2dnaW5nX2luID0gZmFsc2U7XG4gICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBlcnJvcjtcbiAgICAgICAgICAgICRzY29wZS5sb2dnaW5nX2luID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ0xvZ291dENvbnRyb2xsZXInLCBmdW5jdGlvbih1c2VyKSB7XG4gICAgdXNlci5sb2dvdXQoKTtcbn0pO1xuXG4iLCJhcHAuZmFjdG9yeSgnbXNnU3RhY2snLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgbXNncyA9IFtdO1xuICAgIHJldHVybiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgaWYobXNnID09PSBcIlwiKSByZXR1cm4gbXNncztcbiAgICAgICAgbXNncy5wdXNoKHt0eXBlOiBcImluZm9cIiwgbXNnOiBtc2d9KTtcbiAgICAgICAgY29uc29sZS5sb2cob2JqKTtcbiAgICB9O1xufSk7XG5cbmFwcC5mYWN0b3J5KCdVc2VyJywgZnVuY3Rpb24oJGxvZywgJHJlc291cmNlKSB7XG4gICAgdmFyIFVzZXIgPSAkcmVzb3VyY2UoJy9hcGkvMC86cmVzb3VyY2UvOmtleS86dmFsJywge30pO1xuICAgIHJldHVybiBmdW5jdGlvbihrZXksIHZhbCkge1xuICAgICAgICB2YXIgdXNlciA9IFVzZXIuZ2V0KFxuICAgICAgICAgICB7XCJyZXNvdXJjZVwiOiBcInVzZXJzXCIsXG4gICAgICAgICAgICBcImtleVwiOiBrZXksXG4gICAgICAgICAgICBcInZhbFwiOiB2YWx9LFxuICAgICAgICAgICAgZnVuY3Rpb24odSkge1xuICAgICAgICAgICAgICAgICRsb2cuaW5mbyh1LmRhdGFbMF0pO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24odSkge1xuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoXCJFcnJvclwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdXNlcjtcbiAgICB9O1xufSk7XG5cbmFwcC5mYWN0b3J5KCdncmF2YXRhcicsIGZ1bmN0aW9uKCRsb2csICRyZXNvdXJjZSkge1xuICAgIHZhciBncmF2YXRhciA9IHt9O1xuICAgIGdyYXZhdGFyLmhhc2ggPSBmdW5jdGlvbihlbWFpbCkge1xuICAgICAgICBpZighXy5jb250YWlucyhlbWFpbCwgXCJAXCIpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3I6IGdvdCBlbXB0eSBlbWFpbFwiKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaGFzaCA9IENyeXB0b0pTLk1ENShlbWFpbCkudG9TdHJpbmcoKTtcbiAgICAgICAgcmV0dXJuIGhhc2g7XG4gICAgfTtcblxuICAgIHJldHVybiBncmF2YXRhcjtcbn0pO1xuXG5hcHAuZmFjdG9yeSgndXNlcicsIGZ1bmN0aW9uKCRxLCAkbG9nLCAkaHR0cCwgJHJvdXRlLCAkY29va2llU3RvcmUsICRsb2NhdGlvbiwgZ3JhdmF0YXIpIHtcbiAgICB2YXIgdXNlciA9IHt9O1xuICAgIHVzZXIuaXNfbG9nZ2VkX2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhbCA9ICRjb29raWVTdG9yZS5nZXQoXCJtZVwiKSAmJiAkY29va2llU3RvcmUuZ2V0KFwiYXV0aFwiKTtcbiAgICAgICAgcmV0dXJuIHZhbDtcbiAgICB9O1xuXG4gICAgdXNlci5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvMC9hdXRoJywge3VzZXJuYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkfSlcbiAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgaWYoIWRhdGEuYXV0aCkge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhLmVycm9yKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGNvb2tpZVN0b3JlLnB1dChcImF1dGhcIiwgZGF0YS5hdXRoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvMC91c2Vycy9tZScsIHtcImhlYWRlcnNcIjoge1wiQXV0aG9yaXphdGlvblwiOiBkYXRhLmF1dGh9fSlcbiAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAkY29va2llU3RvcmUucHV0KFwibWVcIiwge1widXNlcm5hbWVcIjogdXNlcm5hbWUsIFwiZW1haWxcIjogZGF0YS5kYXRhWzBdLmVtYWlsfSk7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICBlcnJvciA9IFwiU29tZXRoaW5nIHdlbnQgd3Jvbmcgd2hpbGUgdHJ5aW5nIHRvIG1ha2UgcmVxdWVzdFwiO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfTtcblxuICAgIHVzZXIubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRjb29raWVTdG9yZS5yZW1vdmUoXCJhdXRoXCIpO1xuICAgICAgICAkY29va2llU3RvcmUucmVtb3ZlKFwibWVcIik7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL1wiKTtcblxuICAgICAgICAvLyBUT0RPOiBVc2UgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKSBpbnN0ZWFkP1xuICAgICAgICAkcm91dGUucmVsb2FkKCk7XG4gICAgfTtcblxuICAgIHVzZXIudXNlcm5hbWUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICRjb29raWVTdG9yZS5nZXQoXCJtZVwiKS51c2VybmFtZTtcbiAgICB9O1xuXG4gICAgdXNlci5lbWFpbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJGNvb2tpZVN0b3JlLmdldChcIm1lXCIpLmVtYWlsO1xuICAgIH07XG5cbiAgICB1c2VyLmdyYXZhdGFyX2hhc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGdyYXZhdGFyLmhhc2godXNlci5lbWFpbCgpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHVzZXI7XG59KTtcbiIsImFwcC5maWx0ZXIoJ2NhcGl0YWxpemUnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgb3V0cHV0ID0gaW5wdXRbMF0udG9VcHBlckNhc2UoKSArIGlucHV0LnN1YnN0cigxLGlucHV0Lmxlbmd0aCk7XG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9