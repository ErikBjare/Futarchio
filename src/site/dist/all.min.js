app=angular.module("FutarchioApp",["ngResource","ngRoute","ngCookies"]),app.config(["$routeProvider","$locationProvider",function(l){l.when("/",{templateUrl:"home.html",controller:"HomeController"}).when("/polls",{templateUrl:"polls.html",controller:"PollsController"}).when("/predictions",{templateUrl:"predictions.html",controller:"PredictionsController"}).when("/profile/:username",{templateUrl:"profile.html",controller:"ProfileController"}).when("/profile",{templateUrl:"profile.html",controller:"ProfileController"}).when("/admin",{templateUrl:"admin.html",controller:"AdminController"}).when("/logout",{templateUrl:"logout.html",controller:"LogoutController"}).when("/login",{templateUrl:"login.html",controller:"LoginController"})}]);
app.controller("MainController",["$scope","$route","$location","user",function(o,e,r,n){o.links_left=[{title:"Polls",url:"polls",beta:!0},{title:"Predictions",url:"predictions",alpha:!0}],o.location=r,o.user=n}]),app.controller("HomeController",["$scope","$log",function(){}]),app.controller("AdminController",["$scope","$resource","msgStack","User",function(o,e,r,n){o.resources=["users","idklol"],o.keys=["email","id"],o.stdin="",o.log=function(e){o.stdout=r(o,e),o.stdin=""},o.findUser=function(){var e=n(o.lookupKey,o.lookupValie);console.log(e)}}]),app.controller("PollsController",["$scope","$resource","$log",function(o){o.polls=[{creator:"erb",text:"This is a poll"},{creator:"clara",text:"This is another poll"}],o.time=(new Date).toISOString()}]),app.controller("PredictionsController",["$scope","$resource","$log",function(){}]),app.controller("PollController",["$scope","$resource","$log",function(o){o.voted=!0,o.votes=0,o.rating=0,o.vote=function(e){o.votes+=1,o.rating=e?o.rating+1:o.rating-1,o.trues=Math.round(1e3*(1+o.rating/o.votes)/2)/10,o.falses=Math.round(1e3*(1-o.rating/o.votes)/2)/10,console.log(o.rating),o.voted=!0}}]),app.controller("ProfileController",["$scope","$routeParams","$location","$cookieStore","gravatar","User",function(o,e,r,n,l,t){return console.log("Missing username routeParam"),e.username?(o.user={},void t("username",e.username).$promise.then(function(e){console.log(e),o.profile=e.data[0],o.profile.gravatar_hash=l.hash(o.profile.email)},function(){o.loading_error=!0})):(console.log("Missing username routeParam"),me=n.get("me"),console.log(me),void(void 0!==me?(console.log("Redirecting to profile"),r.path("/profile/"+me.username)):(console.log("Redirecting to login"),r.path("/login"))))}]),app.controller("LoginController",["$scope","$routeParams","$location","user","$http",function(o,e,r,n){o.logging_in=!1,n.is_logged_in()?r.path("/profile/"+n.username()):o.logged_in=!1,o.login=function(){o.logging_in=!0,n.login(o.username,o.password).then(function(){o.error="",r.path("/profile/"+o.username),o.logging_in=!1},function(e){o.error=e,o.logging_in=!1})}}]),app.controller("LogoutController",["user",function(o){o.logout()}]);
app.factory("msgStack",function(){var r=[];return function(e){return""===msg?r:(r.push({type:"info",msg:msg}),void console.log(e))}}),app.factory("User",["$log","$resource",function(r,e){var t=e("/api/0/:resource/:key/:val",{});return function(e,o){var n=t.get({resource:"users",key:e,val:o},function(e){r.info(e.data[0])},function(){r.error("Error")});return n}}]),app.factory("gravatar",["$log","$resource",function(){var r={};return r.hash=function(r){_.contains(r,"@")||console.error("Error: got empty email");var e=CryptoJS.MD5(r).toString();return e},r}]),app.factory("user",["$q","$log","$http","$route","$cookieStore","$location","gravatar",function(r,e,t,o,n,a,u){var i={};return i.is_logged_in=function(){return val=n.get("me")&&n.get("auth")},i.login=function(e,o){var a=r.defer();return t.post("/api/0/auth",{username:e,password:o}).success(function(r){console.log(r),r.auth?(authkey=r.auth.key,n.put("auth",authkey),t.get("/api/0/users/me",{headers:{Authorization:authkey}}).success(function(r){console.log(r),n.put("me",{username:e,email:r.data[0].email}),a.resolve(r)})):a.reject(r.error)}).error(function(){error="Something went wrong while trying to make request",a.reject(error)}),a.promise},i.logout=function(){n.remove("auth"),n.remove("me"),a.path("/"),o.reload()},i.username=function(){return n.get("me").username},i.email=function(){return n.get("me").email},i.gravatar_hash=function(){return u.hash(i.email())},i}]);
app.filter("capitalize",function(){return function(t){return output=t[0].toUpperCase()+t.substr(1,t.length)}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXJzLmpzIiwiZmFjdG9yaWVzLmpzIiwiZmlsdGVycy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLFFBQUEsT0FBQSxnQkFBQSxhQUFBLFVBQUEsY0FFQSxJQUFBLFFBQVcsaUJBQUEsb0JBQUEsU0FBQSxHQUNULEVBQ0MsS0FBQSxLQUNDLFlBQUEsWUFDQSxXQUFBLG1CQUVELEtBQUEsVUFDQyxZQUFBLGFBQ0EsV0FBQSxvQkFFRCxLQUFBLGdCQUNDLFlBQUEsbUJBQ0EsV0FBQSwwQkFFRCxLQUFBLHNCQUNDLFlBQUEsZUFDQSxXQUFBLHNCQUVELEtBQUEsWUFDQyxZQUFBLGVBQ0EsV0FBQSxzQkFFRCxLQUFBLFVBQ0MsWUFBQSxhQUNBLFdBQUEsb0JBRUQsS0FBQSxXQUNDLFlBQUEsY0FDQSxXQUFBLHFCQUVELEtBQUEsVUFDQyxZQUFBLGFBQ0EsV0FBQTtBQ2xDSixJQUFBLFdBQUEsa0JBQWlDLFNBQUEsU0FBQSxZQUFBLE9BQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUM3QixFQUFBLGFBQUEsTUFBQSxRQUFBLElBQUEsUUFBQSxNQUFBLElBQ2dCLE1BQUEsY0FBQSxJQUFBLGNBQUEsT0FBQSxJQUNoQixFQUFBLFNBQUEsRUFDQSxFQUFBLEtBQUEsS0FHSixJQUFBLFdBQUEsa0JBQWlDLFNBQUEsT0FBQSxlQUdqQyxJQUFBLFdBQUEsbUJBQWtDLFNBQUEsWUFBQSxXQUFBLE9BQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUM5QixFQUFBLFdBQUEsUUFBQSxVQUNBLEVBQUEsTUFBQSxRQUFBLE1BQ0EsRUFBQSxNQUFBLEdBRUEsRUFBQSxJQUFBLFNBQUEsR0FDSSxFQUFBLE9BQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxNQUFBLElBR0osRUFBQSxTQUFBLFdBQ0ksR0FBQSxHQUFBLEVBQUEsRUFBQSxVQUFBLEVBQUEsWUFDQSxTQUFBLElBQUEsT0FJUixJQUFBLFdBQUEsbUJBQWtDLFNBQUEsWUFBQSxP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QUFBLEVBQUEsSUFBQSxTQUlKLEVBQUEsTUFBQSxTQUFBLEVBQUEsR0FDSSxHQUFBLEdBQUEsRUFBQSxPQXNCQSxPQXBCQSxHQUFBLEtBQUEsZUFBQSxTQUFBLEVBQUEsU0FBQSxJQUNBLFFBQUEsU0FBQSxHQUNJLFFBQUEsSUFBQSxHQUNBLEVBQUEsTUFHSSxRQUFBLEVBQUEsS0FBQSxJQUNBLEVBQUEsSUFBQSxPQUFBLFNBQ0EsRUFBQSxJQUFBLG1CQUFBLFNBQUEsY0FBQSxXQUNBLFFBQUEsU0FBQSxHQUNJLFFBQUEsSUFBQSxHQUNBLEVBQUEsSUFBQSxNQUFBLFNBQUEsRUFBQSxNQUFBLEVBQUEsS0FBQSxHQUFBLFFBQ0EsRUFBQSxRQUFBLE1BUkosRUFBQSxPQUFBLEVBQUEsU0FXUixNQUFBLFdBQ0ksTUFBQSxvREFDQSxFQUFBLE9BQUEsU0FHSixFQUFBLFNBR0osRUFBQSxPQUFBLFdBQ0ksRUFBQSxPQUFBLFFBQ0EsRUFBQSxPQUFBLE1BQ0EsRUFBQSxLQUFBLEtBR0EsRUFBQSxVQUdKLEVBQUEsU0FBQSxXQUNJLE1BQUEsR0FBQSxJQUFBLE1BQUEsVUFHSixFQUFBLE1BQUEsV0FDSSxNQUFBLEdBQUEsSUFBQSxNQUFBLE9BR0osRUFBQSxjQUFBLFdBQ0ksTUFBQSxHQUFBLEtBQUEsRUFBQSxVQUdKO0FDNUZKLElBQUEsT0FBQSxhQUFzQixXQUNsQixNQUFBLFVBQUEsR0FFSSxNQURBLFFBQUEsRUFBQSxHQUFBLGNBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSIsImZpbGUiOiJhbGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYXBwID0gYW5ndWxhci5tb2R1bGUoJ0Z1dGFyY2hpb0FwcCcsIFtcIm5nUmVzb3VyY2VcIiwgXCJuZ1JvdXRlXCIsIFwibmdDb29raWVzXCJdKTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgJHJvdXRlUHJvdmlkZXJcbiAgIC53aGVuKCcvJywge1xuICAgIHRlbXBsYXRlVXJsOiAnaG9tZS5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInLFxuICB9KVxuICAgLndoZW4oJy9wb2xscycsIHtcbiAgICB0ZW1wbGF0ZVVybDogJ3BvbGxzLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdQb2xsc0NvbnRyb2xsZXInLFxuICB9KVxuICAgLndoZW4oJy9wcmVkaWN0aW9ucycsIHtcbiAgICB0ZW1wbGF0ZVVybDogJ3ByZWRpY3Rpb25zLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdQcmVkaWN0aW9uc0NvbnRyb2xsZXInLFxuICB9KVxuICAgLndoZW4oJy9wcm9maWxlLzp1c2VybmFtZScsIHtcbiAgICB0ZW1wbGF0ZVVybDogJ3Byb2ZpbGUuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ1Byb2ZpbGVDb250cm9sbGVyJyxcbiAgfSlcbiAgIC53aGVuKCcvcHJvZmlsZScsIHtcbiAgICB0ZW1wbGF0ZVVybDogJ3Byb2ZpbGUuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ1Byb2ZpbGVDb250cm9sbGVyJyxcbiAgfSlcbiAgIC53aGVuKCcvYWRtaW4nLCB7XG4gICAgdGVtcGxhdGVVcmw6ICdhZG1pbi5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnQWRtaW5Db250cm9sbGVyJyxcbiAgfSlcbiAgIC53aGVuKCcvbG9nb3V0Jywge1xuICAgIHRlbXBsYXRlVXJsOiAnbG9nb3V0Lmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdMb2dvdXRDb250cm9sbGVyJyxcbiAgfSlcbiAgIC53aGVuKCcvbG9naW4nLCB7XG4gICAgdGVtcGxhdGVVcmw6ICdsb2dpbi5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJyxcbiAgfSk7XG59KTtcbiIsImFwcC5jb250cm9sbGVyKCdNYWluQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlLCAkbG9jYXRpb24sIHVzZXIpIHtcbiAgICAkc2NvcGUubGlua3NfbGVmdCA9IFt7dGl0bGU6IFwiUG9sbHNcIiwgdXJsOiBcInBvbGxzXCIsIGJldGE6IHRydWV9LFxuICAgICAgICAgICAgICAgICAgICB7dGl0bGU6IFwiUHJlZGljdGlvbnNcIiwgdXJsOiBcInByZWRpY3Rpb25zXCIsIGFscGhhOiB0cnVlfV07XG4gICAgJHNjb3BlLmxvY2F0aW9uID0gJGxvY2F0aW9uO1xuICAgICRzY29wZS51c2VyID0gdXNlcjtcbn0pO1xuXG5hcHAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2cpIHtcbn0pO1xuXG5hcHAuY29udHJvbGxlcignQWRtaW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcmVzb3VyY2UsIG1zZ1N0YWNrLCBVc2VyKSB7XG4gICAgJHNjb3BlLnJlc291cmNlcyA9IFtcInVzZXJzXCIsIFwiaWRrbG9sXCJdO1xuICAgICRzY29wZS5rZXlzID0gW1wiZW1haWxcIiwgXCJpZFwiXTtcbiAgICAkc2NvcGUuc3RkaW4gPSBcIlwiO1xuXG4gICAgJHNjb3BlLmxvZyA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAkc2NvcGUuc3Rkb3V0ID0gbXNnU3RhY2soJHNjb3BlLCBvYmopO1xuICAgICAgICAkc2NvcGUuc3RkaW4gPSBcIlwiO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZmluZFVzZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHVzZXIgPSBVc2VyKCRzY29wZS5sb29rdXBLZXksICRzY29wZS5sb29rdXBWYWxpZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKHVzZXIpO1xuICAgIH07XG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ1BvbGxzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJlc291cmNlLCAkbG9nKSB7XG4gICAgJHNjb3BlLnBvbGxzID0gW3tcImNyZWF0b3JcIjogXCJlcmJcIiwgXCJ0ZXh0XCI6IFwiVGhpcyBpcyBhIHBvbGxcIn0sXG4gICAgICAgICAgICAgICAgICAgIHtcImNyZWF0b3JcIjogXCJjbGFyYVwiLCBcInRleHRcIjogXCJUaGlzIGlzIGFub3RoZXIgcG9sbFwifV07XG4gICAgJHNjb3BlLnRpbWUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ1ByZWRpY3Rpb25zQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJlc291cmNlLCAkbG9nKSB7XG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ1BvbGxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcmVzb3VyY2UsICRsb2cpIHtcbiAgICAkc2NvcGUudm90ZWQgPSB0cnVlO1xuICAgICRzY29wZS52b3RlcyA9IDA7XG4gICAgJHNjb3BlLnJhdGluZyA9IDA7XG5cbiAgICAkc2NvcGUudm90ZSA9IGZ1bmN0aW9uKG9wdGlvbikge1xuICAgICAgICAkc2NvcGUudm90ZXMgKz0gMTtcbiAgICAgICAgJHNjb3BlLnJhdGluZyA9IG9wdGlvbiA/ICRzY29wZS5yYXRpbmcrMSA6ICRzY29wZS5yYXRpbmctMTtcbiAgICAgICAgJHNjb3BlLnRydWVzID0gTWF0aC5yb3VuZCgxMDAwKigxKygkc2NvcGUucmF0aW5nLyRzY29wZS52b3RlcykpLzIpLzEwO1xuICAgICAgICAkc2NvcGUuZmFsc2VzID0gTWF0aC5yb3VuZCgxMDAwKigxLSgkc2NvcGUucmF0aW5nLyRzY29wZS52b3RlcykpLzIpLzEwO1xuICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUucmF0aW5nKTtcbiAgICAgICAgJHNjb3BlLnZvdGVkID0gdHJ1ZTtcbiAgICB9O1xufSk7XG5cbmFwcC5jb250cm9sbGVyKCdQcm9maWxlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRjb29raWVTdG9yZSwgZ3JhdmF0YXIsIFVzZXIpIHtcbiAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgdXNlcm5hbWUgcm91dGVQYXJhbVwiKTtcbiAgICBpZighJHJvdXRlUGFyYW1zLnVzZXJuYW1lKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTWlzc2luZyB1c2VybmFtZSByb3V0ZVBhcmFtXCIpO1xuICAgICAgICBtZSA9ICRjb29raWVTdG9yZS5nZXQoXCJtZVwiKTtcbiAgICAgICAgY29uc29sZS5sb2cobWUpO1xuICAgICAgICBpZihtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlZGlyZWN0aW5nIHRvIHByb2ZpbGVcIik7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9wcm9maWxlL1wiK21lLnVzZXJuYW1lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVkaXJlY3RpbmcgdG8gbG9naW5cIik7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9sb2dpblwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICBVc2VyKFwidXNlcm5hbWVcIiwgJHJvdXRlUGFyYW1zLnVzZXJuYW1lKS4kcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHBheWxvYWQpIHtcbiAgICAgICAgY29uc29sZS5sb2cocGF5bG9hZCk7XG4gICAgICAgICRzY29wZS5wcm9maWxlID0gcGF5bG9hZC5kYXRhWzBdO1xuICAgICAgICAkc2NvcGUucHJvZmlsZS5ncmF2YXRhcl9oYXNoID0gZ3JhdmF0YXIuaGFzaCgkc2NvcGUucHJvZmlsZS5lbWFpbCk7XG4gICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmdfZXJyb3IgPSB0cnVlO1xuICAgIH0pO1xufSk7XG5cbmFwcC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCB1c2VyLCAkaHR0cCkge1xuICAgIC8vVE9ETzogU2V0IDMwIGRheSBjb29raWUgZXhwaXJ5IHVwb24gXCJSZW1lbWJlciBtZVwiXG4gICAgJHNjb3BlLmxvZ2dpbmdfaW4gPSBmYWxzZTtcblxuICAgIGlmKHVzZXIuaXNfbG9nZ2VkX2luKCkpIHtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvcHJvZmlsZS9cIit1c2VyLnVzZXJuYW1lKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgICRzY29wZS5sb2dnZWRfaW4gPSBmYWxzZTtcbiAgICB9XG5cbiAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLmxvZ2dpbmdfaW4gPSB0cnVlO1xuICAgICAgICB1c2VyLmxvZ2luKCRzY29wZS51c2VybmFtZSwgJHNjb3BlLnBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICRzY29wZS5lcnJvciA9IFwiXCI7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9wcm9maWxlL1wiKyRzY29wZS51c2VybmFtZSk7XG4gICAgICAgICAgICAkc2NvcGUubG9nZ2luZ19pbiA9IGZhbHNlO1xuICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gZXJyb3I7XG4gICAgICAgICAgICAkc2NvcGUubG9nZ2luZ19pbiA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xufSk7XG5cbmFwcC5jb250cm9sbGVyKCdMb2dvdXRDb250cm9sbGVyJywgZnVuY3Rpb24odXNlcikge1xuICAgIHVzZXIubG9nb3V0KCk7XG59KTtcblxuIiwiYXBwLmZhY3RvcnkoJ21zZ1N0YWNrJywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIG1zZ3MgPSBbXTtcbiAgICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgIGlmKG1zZyA9PT0gXCJcIikgcmV0dXJuIG1zZ3M7XG4gICAgICAgIG1zZ3MucHVzaCh7dHlwZTogXCJpbmZvXCIsIG1zZzogbXNnfSk7XG4gICAgICAgIGNvbnNvbGUubG9nKG9iaik7XG4gICAgfTtcbn0pO1xuXG5hcHAuZmFjdG9yeSgnVXNlcicsIGZ1bmN0aW9uKCRsb2csICRyZXNvdXJjZSkge1xuICAgIHZhciBVc2VyID0gJHJlc291cmNlKCcvYXBpLzAvOnJlc291cmNlLzprZXkvOnZhbCcsIHt9KTtcbiAgICByZXR1cm4gZnVuY3Rpb24oa2V5LCB2YWwpIHtcbiAgICAgICAgdmFyIHVzZXIgPSBVc2VyLmdldChcbiAgICAgICAgICAge1wicmVzb3VyY2VcIjogXCJ1c2Vyc1wiLFxuICAgICAgICAgICAgXCJrZXlcIjoga2V5LFxuICAgICAgICAgICAgXCJ2YWxcIjogdmFsfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uKHUpIHtcbiAgICAgICAgICAgICAgICAkbG9nLmluZm8odS5kYXRhWzBdKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHUpIHtcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKFwiRXJyb3JcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfTtcbn0pO1xuXG5hcHAuZmFjdG9yeSgnZ3JhdmF0YXInLCBmdW5jdGlvbigkbG9nLCAkcmVzb3VyY2UpIHtcbiAgICB2YXIgZ3JhdmF0YXIgPSB7fTtcbiAgICBncmF2YXRhci5oYXNoID0gZnVuY3Rpb24oZW1haWwpIHtcbiAgICAgICAgaWYoIV8uY29udGFpbnMoZW1haWwsIFwiQFwiKSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yOiBnb3QgZW1wdHkgZW1haWxcIik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5NRDUoZW1haWwpLnRvU3RyaW5nKCk7XG4gICAgICAgIHJldHVybiBoYXNoO1xuICAgIH07XG5cbiAgICByZXR1cm4gZ3JhdmF0YXI7XG59KTtcblxuYXBwLmZhY3RvcnkoJ3VzZXInLCBmdW5jdGlvbigkcSwgJGxvZywgJGh0dHAsICRyb3V0ZSwgJGNvb2tpZVN0b3JlLCAkbG9jYXRpb24sIGdyYXZhdGFyKSB7XG4gICAgdmFyIHVzZXIgPSB7fTtcbiAgICB1c2VyLmlzX2xvZ2dlZF9pbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YWwgPSAkY29va2llU3RvcmUuZ2V0KFwibWVcIikgJiYgJGNvb2tpZVN0b3JlLmdldChcImF1dGhcIik7XG4gICAgICAgIHJldHVybiB2YWw7XG4gICAgfTtcblxuICAgIHVzZXIubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAkaHR0cC5wb3N0KCcvYXBpLzAvYXV0aCcsIHt1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZH0pXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIGlmKCFkYXRhLmF1dGgpIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YS5lcnJvcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGF1dGhrZXkgPSBkYXRhLmF1dGgua2V5O1xuICAgICAgICAgICAgICAgICRjb29raWVTdG9yZS5wdXQoXCJhdXRoXCIsIGF1dGhrZXkpO1xuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS8wL3VzZXJzL21lJywge1wiaGVhZGVyc1wiOiB7XCJBdXRob3JpemF0aW9uXCI6IGF1dGhrZXl9fSlcbiAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAkY29va2llU3RvcmUucHV0KFwibWVcIiwge1widXNlcm5hbWVcIjogdXNlcm5hbWUsIFwiZW1haWxcIjogZGF0YS5kYXRhWzBdLmVtYWlsfSk7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICBlcnJvciA9IFwiU29tZXRoaW5nIHdlbnQgd3Jvbmcgd2hpbGUgdHJ5aW5nIHRvIG1ha2UgcmVxdWVzdFwiO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfTtcblxuICAgIHVzZXIubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRjb29raWVTdG9yZS5yZW1vdmUoXCJhdXRoXCIpO1xuICAgICAgICAkY29va2llU3RvcmUucmVtb3ZlKFwibWVcIik7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL1wiKTtcblxuICAgICAgICAvLyBUT0RPOiBVc2UgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKSBpbnN0ZWFkP1xuICAgICAgICAkcm91dGUucmVsb2FkKCk7XG4gICAgfTtcblxuICAgIHVzZXIudXNlcm5hbWUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICRjb29raWVTdG9yZS5nZXQoXCJtZVwiKS51c2VybmFtZTtcbiAgICB9O1xuXG4gICAgdXNlci5lbWFpbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJGNvb2tpZVN0b3JlLmdldChcIm1lXCIpLmVtYWlsO1xuICAgIH07XG5cbiAgICB1c2VyLmdyYXZhdGFyX2hhc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGdyYXZhdGFyLmhhc2godXNlci5lbWFpbCgpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHVzZXI7XG59KTtcbiIsImFwcC5maWx0ZXIoJ2NhcGl0YWxpemUnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgb3V0cHV0ID0gaW5wdXRbMF0udG9VcHBlckNhc2UoKSArIGlucHV0LnN1YnN0cigxLGlucHV0Lmxlbmd0aCk7XG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9